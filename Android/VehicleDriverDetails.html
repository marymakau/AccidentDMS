<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Accident DMS</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <!-- Ionicons -->
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="plugins/iCheck/all.css">
  <link rel="stylesheet" href="jqueryui/jquery-ui.min.css"/>
  <!-- Select2 -->
  <link rel="stylesheet" href="plugins/select2/select2.min.css">
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script>
    var login = window.localStorage.getItem('login');         
    if(login !== '1'){
      window.location = 'login.html';
    }
  </script>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

  <header class="main-header">    

    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
     <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a> <br><div style='color:white;float:right;padding-right:20px'><script>document.write('Police Officer ');document.write(window.localStorage.getItem('LastName'));
    document.write(' ');document.write(window.localStorage.getItem('FirstName'));</script>
    </div>
     </nav>
  </header>

  <!-- =============================================== -->

  <!-- Left side column. contains the sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
     
      
      <ul class="sidebar-menu">
         <li>
                        <a href="NewAccident.html"><i class="glyphicon glyphicon-home"></i> Home</a>
                    </li>
                    <li class="active">
                        <a href="NewAccident.html"><i class="glyphicon glyphicon-file"></i> File New Accident</a>
                    </li>
                    <li>
                        <a href="NewAccident.html"><i class="glyphicon glyphicon-edit"></i> Edit Stored Accident</a>
                    </li>
                    
                    <li>
                        <a href="NewAccident.html"><i class="glyphicon glyphicon-open-file"></i> View Stored Accident</a>
                    </li>
                    <li>
                        <a href="NewAccident.html"><i class="glyphicon glyphicon-user"></i> Profile</a>
                    </li>
                    <li>
                  <a href="login.html"onclick="localStorage.removeItem('UserName');"><i class="glyphicon glyphicon-off"></i> Logout</a>
                    </li>
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- =============================================== -->

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        <small><strong>Vehicles No.1 Driver Details</strong></small>
      </h1>
       <ol class="breadcrumb">
      <li>
          <i class="glyphicon glyphicon-home"></i>  <a href="index.html">Home</a>
      </li>
      <li class="active">
          <i class="glyphicon glyphicon-automobile"></i> Vehicle and Driver Details
      </li>
  </ol>
</section>
    <!-- Main content -->
    <section class="content">
      <!-- Default box -->
      <div class="box">        
        <div class="box-body">
        <form name="searchForm"
          id="vehicleDriverDetailsForm"
          method="post">
            <div class="form-group">
              <label>Vehicle number of passengers/occupants</label>
              <input class="form-control"
                 type='number'
                 name='totalPassengers'
                 id="totalPassengers"
                 placeholder="Enter number of passengers/occupants">
            </div>
            <div class="form-group">
              <label>Number of deaths</label>
              <input class="form-control"
                 type='number'
                 name='numberOfDeath'
                 id="numberOfDeath"
                 placeholder="Passengers/occupants death count">
            </div>
            <div class="form-group">
             <label>Number of seriously injured</label>
             <input class="form-control"
                type='number'
                name='seriousInjury'
                id="seriousInjury"
                placeholder="Passengers/occupants seriously injured ">
            </div>
            <div class="form-group">
             <label>Number of minorly injured</label>
             <input class="form-control"
                type='number'
                name='minorInjury'
                id="minorInjury"
                placeholder="Passengers/occupants minorly injured ">
            </div>            
            <div class="form-group">
              <label>Driver Licence Number</label>
              <input type="text"
                class="form-control"
                id="licenceNumber"
                name="licenceNumber"
                autocomplete="off"
                placeholder="Licence number"
                list="LicenceN">   
              <datalist id="LicenceN">

              </datalist>
              <span class="text-danger" id="LicenceResponse"></span>
            </div> 
            <div class="form-group"> 
              <label>Driver National ID Number</label>
              <input type="text"
                class="form-control"
                id="DriverID"
                name="DriverID"
                placeholder="Automatically filled " readonly>             
               <span class="text-danger" id="DriverIDResponse"> </span>
            </div>
            <div class="form-group"> 
             <label>Driver Name</label>

              <input type="text"
                class="form-control"
                id="DriverName"
                name="DriverName"
                placeholder="Automatically filled " readonly>             
               <span class="text-danger" id="DriverNameResponse"></span>
            </div>
            <div class="form-group"> 
             <label>Driver Gender</label>
              <input type="text"
                class="form-control"
                id="DriverGender"
                name="DriverGender"
                placeholder="Automatically filled " readonly>             
               <span class="text-danger" id="DriverGenderResponse"></span>
            </div>
            <div class="form-group"> 
              <input type="hidden"
                class="form-control"
                id="DriverAge"
                name="DriverAge"
                placeholder="Automatically filled"
                readonly>             
              <span class="text-danger" id="DriverAgeResponse"></span>
            </div>
            
            <div class="form-group">
              <label> Driver seriously Injured?</label>  <br>             
              <label>
                <input type="radio" class="flat-red" id='driverSeriouslyInjured'  name="driverSeriouslyInjured">
                Yes
              </label>
              <br>
             <label>
               <input type="radio" class="flat-red"  id='driverSeriouslyInjured' name="driverSeriouslyInjured">
               No
             </label>
            </div>
          
            <div class="form-group">
              <label> Driver Dead?</label>  <br>             
              <label>
                <input type="radio" id='driverDead' class="flat-red" name="driverDead">
                Yes
              </label>
              <br>
              <label>
                <input type="radio" id='driverDead' class="flat-red" name="driverDead" >
                No
              </label>
            </div> 
            <div class="form-group">
              <label> Driver Drunk?</label>  <br>             
              <label>
                <input type="radio" id='driverDrunk' class="flat-red" name="driverDrunk">
                Yes
              </label>
              <br>
              <label>
                <input type="radio" id='driverDrunk' class="flat-red" name="driverDrunk" >
                No
              </label>
            </div>      
            <br>
            <div class="form-group">
             <label> Comments about the driver/drivivng</label>  <br>             
            <textarea class="form-control" 
                id="driverComments" 
                name="driverComments"
                rows="2" 
                placeholder="Comments about the driver/drivivng"; 
                style='resize: none;'></textarea>
            </div> <br>
            <b class="active"> 
                <a href="VehicleDetails.html" style='float:right' id="nextVehicleDetails2"> 
                  <i class="glyphicon glyphicon-forward"></i>
                </a>
            </b>
            <b class="active"> 
                <a href="VehicleDetails.html"> <i class="glyphicon glyphicon-backward"></i></a>
             </b> 
          </form>
        </div> 
</div>

    </section>
        <script src="js/jquery.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="jqueryui/jquery-ui.min.js"></script>
        <script>
            $(document).on('keyup blur focusout', '#licenceNumber', function(e){
                e.preventDefault();
                GetDriverDetails();                
            });
            
            $(document).on('click', '.ui-autocomplete > .ui-menu-item > .ui-menu-item-wrapper', function(e){
                e.preventDefault();
                GetDriverDetails(); 

            });
            
            function GetDriverDetails()
            {
                $('#DriverID').val(''); 
                $('#DriverGender').val('');
                $('#DriverName').val('');
                $('#DriverAge').val('');               
                var licenceNumber = $('#licenceNumber').val();
                var data = {
                    REQUEST_TYPE:'GET_DRIVER_DETAILS',
                    licenceNumber:licenceNumber
                };
                
                var srvRqst = $.ajax({
                    url:'PoliceServer/route.php',
                    data:data,
                    type:'post',
                    datatype:'json'   
                });
                
                srvRqst.done(function(srvResponse)
                {                   
                    var responseObj = $.parseJSON(srvResponse); 
                    
                    $('#DriverID').val(responseObj['NationalIdNumber']),
                    $('#DriverGender').val(responseObj['Gender']),
                    $('#DriverName').val(responseObj['FullNames']);
                    var birth = new Date(responseObj['DOB']);
                      var check = new Date();
                      var milliDay = 1000 * 60 * 60 * 24;
                    var ageInDays = (check - birth) / milliDay;
                    var ageInYears =  Math.floor(ageInDays / 365 );
                    var age =  ageInDays / 365 ;                    
                    $('#DriverAge').val(ageInYears);


                }); 
            }
            
            GetAllLicences();
            
            function GetAllLicences()
            {
                var data = {
                    REQUEST_TYPE:'GET_ALL_LICENCE_NUM'
                };
                
                var srvRqst = $.ajax({
                    url:'PoliceServer/route.php',
                    data:data,
                    type:'post',
                    datatype:'json'   
                });
                
                srvRqst.done(function(srvResponse)
                {                    
                    var responseObj = $.parseJSON(srvResponse); 
                    var regNums = [];
                    var html = '';
                    for(var i = 0; i< responseObj.length; i++)
                    {
                        regNums.push(responseObj[i]['LicenceNumber']);
                    }
                    
                    $('#licenceNumber').autocomplete({
                        source:regNums
                    });
                });
            }
        </script>
   </div>
  <!-- /.content-wrapper -->

  <footer class="main-footer">
    <div class="pull-right hidden-xs">
    </div>
    <strong>Copyright &copy; 2016 <a href="index.html">Kenya Traffic Police</a>.</strong> 
    All rights reserved.
  </footer>

   <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.3 -->
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- jQuery 2.2.3 -->
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- Select2 -->
<script src="plugins/select2/select2.full.min.js"></script>
<!-- SlimScroll 1.3.0 -->
<!-- iCheck 1.0.1 -->
<script src="plugins/iCheck/icheck.min.js"></script>

<!-- Page script -->
<script>
  $(function () {
    //Initialize Select2 Elements
    $(".select2").select2();

     //Flat red color scheme for iCheck
    $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
      checkboxClass: 'icheckbox_flat-blue',
      radioClass: 'iradio_flat-blue'
    });

   });
</script>
<!--Auto populate Vehicle and Driver Details Form-->
  <script>
   var srvRqst = $.ajax({
      url:'PoliceServer/route.php',
      data:{
          REQUEST_TYPE:'GET_ACCIDENT_FORM_DATA',
          UserName: window.localStorage.getItem('UserName'),

          formType: 'VEHICLE_DRIVER_DETAILS_FORM',
          accidentID: window.localStorage.getItem('AccidentID'),
        },
      type:'post',
      datatype:'json'
    });    srvRqst.done(function(responseMsg){
       var responseObj = $.parseJSON(responseMsg);
       if(responseObj['STATUS'] === '1'){
         var formData = responseObj['DATA']['data'];
         setTimeout(function(){
            $('#totalPassengers').val(formData['data']['totalPassengers']);       
            $('#numberOfDeath').val(formData['data']['numberOfDeath']);
            $('#seriousInjury').val(formData['data']['seriousInjury']);            
            $('#minorInjury').val(formData['data']['minorInjury']);
            $('#licenceNumber').val(formData['data']['licenceNumber']);
            $('#DriverID').val(formData['data']['driverID']);
            $('#DriverName').val(formData['data']['driverName']);
            $('#DriverGender').val(formData['data']['driverGender']);
            $('#DriverAge').val(formData['data']['driverAge']);
            $('#driverSeriouslyInjured').val(formData['data']['driverSeriouslyInjured']);
            $('#driverDead').val(formData['data']['driverDead']);            
            $('#driverDrunk').val(formData['data']['driverDrunk']);           
           $('#driverComments').val(formData['data']['driverComments']);
      }, 0);
              
       } 
     });
  </script>
<script>
  $(document).on('click', '#nextVehicleDetails2', function(e){    
    e.preventDefault();
    var totalPassengers = $('#totalPassengers').val();   
    var numberOfDeath = $('#numberOfDeath').val();
    var seriousInjury = $('#seriousInjury').val();
    var minorInjury = $('#minorInjury').val();
    var licenceNumber = $('#licenceNumber').val();
    var driverID = $('#DriverID').val();
    var driverName = $('#DriverName').val();
    var driverGender = $('#DriverGender').val();
    var driverAge = $('#DriverAge').val();
    var driverComments= $('#driverComments').val();
    var driverSeriouslyInjured = null;
    var driverDead = null;
    var driverDrunk = null;     
    if($('input[name=driverSeriouslyInjured][value=Yes]').is(':checked')){
      driverSeriouslyInjured = 'Yes';
    }
    else{
      driverSeriouslyInjured = 'No';
    }
    
    if($('input[name=driverDead][value=Yes]').is(':checked')){
      driverDead = 'Yes';
    }
    else{
      driverDead = 'No';
    }
    if($('input[name=driverDrunk][value=Yes]').is(':checked')){
      driverDrunk = 'Yes';
    }
    else{
      driverDrunk = 'No';
    }
    var data = {
      REQUEST_TYPE:'VEHICLE_DRIVER_DETAILS_FORM', 
      UserName: window.localStorage.getItem('UserName'),
      AccidentID: window.localStorage.getItem('AccidentID'),     
      totalPassengers: totalPassengers,
      numberOfDeath: numberOfDeath,
      seriousInjury: seriousInjury,
      minorInjury: minorInjury,
      licenceNumber: licenceNumber,
      driverID: driverID,
      driverName: driverName,
      driverGender: driverGender,
      driverAge: driverAge,
      driverSeriouslyInjured: driverSeriouslyInjured,
      driverDead: driverDead,      
      driverDrunk: driverDrunk,
      driverComments: driverComments
    };
   
    
    var srvRqst = $.ajax({
      url:'PoliceServer/route.php',
      data:data,
      type:'post',
      datatype:'json'
    }); 
    
    srvRqst.done(function(srvResponse){
      var responseMsg = $.parseJSON(srvResponse);  
      if(responseMsg['STATUS'] === '1'){
        
        window.location = 'PoliceRemarks.html'; 
      }        
    });   
  });
</script>

</body>
</html>
